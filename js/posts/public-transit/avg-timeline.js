const isMobile = window.matchMedia('(max-width: 480px)').matches;

const avgData = [
  {
    hovertemplate:
      'LADOT<br>%{x}<br>Average monthly riders: %{y}<extra></extra>',
    legendgroup: 'LADOT',
    line: {
      color: 'rgb(102, 197, 204)',
      dash: 'solid',
      shape: 'spline',
    },
    marker: {
      symbol: 'circle',
    },
    mode: 'markers+lines',
    name: 'LADOT',
    orientation: 'v',
    showlegend: true,
    type: 'scatter',
    x: [
      'Jan. 19',
      'Feb. 19',
      'Mar. 19',
      'Apr. 19',
      'May 19',
      'Jun. 19',
      'Jul. 19',
      'Aug. 19',
      'Sep. 19',
      'Oct. 19',
      'Nov. 19',
      'Dec. 19',
      'Jan. 20',
      'Feb. 20',
      'Mar. 20',
      'Apr. 20',
      'May 20',
      'Jun. 20',
      'Jul. 20',
      'Aug. 20',
      'Sep. 20',
      'Oct. 20',
      'Nov. 20',
      'Dec. 20',
      'Jan. 21',
      'Feb. 21',
      'Mar. 21',
      'Apr. 21',
      'May 21',
      'Jun. 21',
      'Jul. 21',
      'Aug. 21',
      'Sep. 21',
      'Oct. 21',
    ],
    xaxis: 'x',
    y: [
      7675.0,
      7395.67,
      7976.0,
      8113.67,
      8464.67,
      7498.33,
      8184.33,
      8245.67,
      7700.67,
      8367.33,
      7111.67,
      6334.67,
      6846.0,
      5583.67,
      3077.33,
      405.0,
      484.0,
      786.33,
      944.0,
      955.33,
      1068.0,
      1139.67,
      1044.67,
      819.0,
      844.33,
      950.33,
      1227.0,
      1256.33,
      1250.67,
      1674.0,
      1600.67,
      2045.33,
      2440.33,
      2459.33,
    ],
    yaxis: 'y',
  },
  {
    hovertemplate:
      'Big Blue Bus<br>%{x}<br>Average monthly riders: %{y}<extra></extra>',
    legendgroup: 'Big Blue Bus',
    line: {
      color: '#c198d6',
      dash: 'solid',
      shape: 'spline',
    },
    marker: {
      symbol: 'circle',
      line: {
        color: '#222222',
        width: 0.5,
      },
    },
    mode: 'markers+lines',
    name: 'Big Blue Bus',
    orientation: 'v',
    showlegend: true,
    type: 'scatter',
    x: [
      'Jan. 19',
      'Feb. 19',
      'Mar. 19',
      'Apr. 19',
      'May 19',
      'Jun. 19',
      'Jul. 19',
      'Aug. 19',
      'Sep. 19',
      'Oct. 19',
      'Nov. 19',
      'Dec. 19',
      'Jan. 20',
      'Feb. 20',
      'Mar. 20',
      'Apr. 20',
      'May 20',
      'Jun. 20',
      'Jul. 20',
      'Aug. 20',
      'Sep. 20',
      'Oct. 20',
      'Nov. 20',
      'Dec. 20',
      'Jan. 21',
      'Feb. 21',
      'Mar. 21',
      'Apr. 21',
      'May 21',
      'Jun. 21',
      'Jul. 21',
      'Aug. 21',
      'Sep. 21',
      'Oct. 21',
    ],
    xaxis: 'x',
    y: [
      null,
      null,
      102356.11,
      null,
      null,
      96350.4,
      null,
      108204.15,
      null,
      null,
      null,
      null,
      null,
      58361.74,
      null,
      null,
      46392.21,
      null,
      null,
      null,
      45028.23,
      null,
      null,
      null,
      null,
      null,
      null,
      48174.15,
      null,
      null,
      null,
      55555.95,
      null,
      null,
    ],
    yaxis: 'y',
  },
  {
    hovertemplate:
      'AVTA<br>%{x}<br>Average monthly riders: %{y}<extra></extra>',
    legendgroup: 'AVTA',
    line: {
      color: 'rgb(246, 207, 113)',
      dash: 'solid',
      shape: 'spline',
    },
    marker: {
      symbol: 'circle',
    },
    mode: 'markers+lines',
    name: 'AVTA',
    orientation: 'v',
    showlegend: true,
    type: 'scatter',
    x: [
      'Jan. 19',
      'Feb. 19',
      'Mar. 19',
      'Apr. 19',
      'May 19',
      'Jun. 19',
      'Jul. 19',
      'Aug. 19',
      'Sep. 19',
      'Oct. 19',
      'Nov. 19',
      'Dec. 19',
      'Jan. 20',
      'Feb. 20',
      'Mar. 20',
      'Apr. 20',
      'May 20',
      'Jun. 20',
      'Jul. 20',
      'Aug. 20',
      'Sep. 20',
      'Oct. 20',
      'Nov. 20',
      'Dec. 20',
      'Jan. 21',
      'Feb. 21',
      'Mar. 21',
      'Apr. 21',
      'May 21',
      'Jun. 21',
      'Jul. 21',
      'Aug. 21',
      'Sep. 21',
      'Oct. 21',
    ],
    xaxis: 'x',
    y: [
      3600.0,
      2930.0,
      3289.0,
      4070.0,
      4206.0,
      1876.0,
      1482.0,
      3261.0,
      3209.0,
      3285.0,
      2990.0,
      2388.0,
      3005.0,
      2991.0,
      1762.0,
      0.0,
      230.0,
      780.0,
      468.0,
      0.0,
      0.0,
      473.0,
      760.0,
      866.0,
      954.0,
      1047.0,
      1262.0,
      42.0,
      0.0,
      78.0,
      94.0,
      0.0,
      62.0,
      59.0,
    ],
    yaxis: 'y',
  },
  {
    hovertemplate:
      'Santa Clarita Transit<br>%{x}<br>Average monthly riders: %{y}<extra></extra>',
    legendgroup: 'Santa Clarita Transit',
    line: {
      color: 'rgb(248, 156, 116)',
      dash: 'solid',
      shape: 'spline',
    },
    marker: {
      symbol: 'circle',
    },
    mode: 'markers+lines',
    name: 'Santa Clarita Transit',
    orientation: 'v',
    showlegend: true,
    type: 'scatter',
    x: [
      'Jan. 19',
      'Feb. 19',
      'Mar. 19',
      'Apr. 19',
      'May 19',
      'Jun. 19',
      'Jul. 19',
      'Aug. 19',
      'Sep. 19',
      'Oct. 19',
      'Nov. 19',
      'Dec. 19',
      'Jan. 20',
      'Feb. 20',
      'Mar. 20',
      'Apr. 20',
      'May 20',
      'Jun. 20',
      'Jul. 20',
      'Aug. 20',
      'Sep. 20',
      'Oct. 20',
      'Nov. 20',
      'Dec. 20',
      'Jan. 21',
      'Feb. 21',
      'Mar. 21',
      'Apr. 21',
      'May 21',
      'Jun. 21',
      'Jul. 21',
      'Aug. 21',
      'Sep. 21',
      'Oct. 21',
    ],
    xaxis: 'x',
    y: [
      3594.0,
      3622.5,
      3548.0,
      3749.5,
      3663.5,
      2629.0,
      3485.5,
      3510.0,
      3467.0,
      4023.5,
      3133.0,
      2804.5,
      3691.5,
      3293.0,
      1963.0,
      220.5,
      290.0,
      536.5,
      535.5,
      583.5,
      646.5,
      783.5,
      602.0,
      565.5,
      679.5,
      717.0,
      826.5,
      740.5,
      802.0,
      1091.0,
      1052.5,
      1224.5,
      994.0,
      1541.0,
    ],
    yaxis: 'y',
  },
];

const avgLayout = {
  height: 480,
  legend: {
    y: 1.2,
    orientation: 'h',
    tracegroupgap: 0,
    x: -0.1,
  },
  margin: {
    r: 15,
    t: 130,
  },
  annotations: [
    {
      showarrow: false,
      text: 'CA stay-at-home<br>order issued',
      x: 14,
      xanchor: 'left',
      xref: 'x',
      y: 1,
      yanchor: 'top',
      yref: 'y domain',
    },
  ],
  shapes: [
    {
      line: { dash: 'dot' },
      type: 'line',
      x0: 14,
      x1: 14,
      xref: 'x',
      y0: 0,
      y1: 1,
      yref: 'y domain',
    },
  ],
  template: {
    data: {
      scatter: [
        {
          marker: { colorbar: { outlinewidth: 0, ticks: '' } },
          type: 'scatter',
        },
      ],
    },
    layout: {
      annotationdefaults: {
        arrowcolor: '#2a3f5f',
        arrowhead: 0,
        arrowwidth: 1,
      },
      autotypenumbers: 'strict',
      coloraxis: { colorbar: { outlinewidth: 0, ticks: '' } },
      colorscale: {
        diverging: [
          [0, '#8e0152'],
          [0.1, '#c51b7d'],
          [0.2, '#de77ae'],
          [0.3, '#f1b6da'],
          [0.4, '#fde0ef'],
          [0.5, '#f7f7f7'],
          [0.6, '#e6f5d0'],
          [0.7, '#b8e186'],
          [0.8, '#7fbc41'],
          [0.9, '#4d9221'],
          [1, '#276419'],
        ],
        sequential: [
          [0.0, '#0d0887'],
          [0.1111111111111111, '#46039f'],
          [0.2222222222222222, '#7201a8'],
          [0.3333333333333333, '#9c179e'],
          [0.4444444444444444, '#bd3786'],
          [0.5555555555555556, '#d8576b'],
          [0.6666666666666666, '#ed7953'],
          [0.7777777777777778, '#fb9f3a'],
          [0.8888888888888888, '#fdca26'],
          [1.0, '#f0f921'],
        ],
        sequentialminus: [
          [0.0, '#0d0887'],
          [0.1111111111111111, '#46039f'],
          [0.2222222222222222, '#7201a8'],
          [0.3333333333333333, '#9c179e'],
          [0.4444444444444444, '#bd3786'],
          [0.5555555555555556, '#d8576b'],
          [0.6666666666666666, '#ed7953'],
          [0.7777777777777778, '#fb9f3a'],
          [0.8888888888888888, '#fdca26'],
          [1.0, '#f0f921'],
        ],
      },
      colorway: [
        '#636efa',
        '#EF553B',
        '#00cc96',
        '#ab63fa',
        '#FFA15A',
        '#19d3f3',
        '#FF6692',
        '#B6E880',
        '#FF97FF',
        '#FECB52',
      ],
      font: { color: '#2a3f5f' },
      geo: {
        bgcolor: 'white',
        lakecolor: 'white',
        landcolor: '#E5ECF6',
        showlakes: true,
        showland: true,
        subunitcolor: 'white',
      },
      hoverlabel: { align: 'left' },
      hovermode: 'closest',
      mapbox: { style: 'light' },
      paper_bgcolor: 'white',
      plot_bgcolor: '#E5ECF6',
      polar: {
        angularaxis: { gridcolor: 'white', linecolor: 'white', ticks: '' },
        bgcolor: '#E5ECF6',
        radialaxis: { gridcolor: 'white', linecolor: 'white', ticks: '' },
      },
      scene: {
        xaxis: {
          backgroundcolor: '#E5ECF6',
          gridcolor: 'white',
          gridwidth: 2,
          linecolor: 'white',
          showbackground: true,
          ticks: '',
          zerolinecolor: 'white',
        },
        yaxis: {
          backgroundcolor: '#E5ECF6',
          gridcolor: 'white',
          gridwidth: 2,
          linecolor: 'white',
          showbackground: true,
          ticks: '',
          zerolinecolor: 'white',
        },
        zaxis: {
          backgroundcolor: '#E5ECF6',
          gridcolor: 'white',
          gridwidth: 2,
          linecolor: 'white',
          showbackground: true,
          ticks: '',
          zerolinecolor: 'white',
        },
      },
      shapedefaults: { line: { color: '#2a3f5f' } },
      ternary: {
        aaxis: { gridcolor: 'white', linecolor: 'white', ticks: '' },
        baxis: { gridcolor: 'white', linecolor: 'white', ticks: '' },
        bgcolor: '#E5ECF6',
        caxis: { gridcolor: 'white', linecolor: 'white', ticks: '' },
      },
      title: { x: 0.05 },
      xaxis: {
        automargin: true,
        gridcolor: 'white',
        linecolor: 'white',
        ticks: '',
        title: { standoff: 15 },
        zerolinecolor: 'white',
        zerolinewidth: 2,
      },
      yaxis: {
        automargin: true,
        gridcolor: 'white',
        linecolor: 'white',
        ticks: '',
        title: { standoff: 15 },
        zerolinecolor: 'white',
        zerolinewidth: 2,
      },
    },
  },
  title: {
    text: '<b>Average monthly ridership<br>per bus line</b>',
    font: {
      size: 20,
    },
    xref: 'container',
    y: 0.9,
    yanchor: 'top',
    yref: 'container',
    x: 0.5,
  },
  xaxis: {
    anchor: 'y',
    domain: [0.0, 1.0],
    tickangle: -60,
    title: { text: 'Month' },
    fixedrange: true,
  },
  yaxis: {
    anchor: 'x',
    domain: [0.0, 1.0],
    fixedrange: true,
    nticks: 20,
    tickformat: ',',
    title: {
      text: 'Average monthly riders',
    },
  },
};

if (!isMobile) {
  avgLayout.height = 450;
  avgLayout.legend.x = 0;
  avgLayout.margin.t = 100;
  avgLayout.title.xref = 'paper';
  avgLayout.annotations = [
    {
      showarrow: false,
      text: 'First COVID-19 case in LA',
      x: 12,
      xanchor: 'right',
      xref: 'x',
      y: 1,
      yanchor: 'top',
      yref: 'y domain',
    },
    {
      showarrow: false,
      text: 'CA stay-at-home<br>order issued',
      x: 14,
      xanchor: 'left',
      xref: 'x',
      y: 1,
      yanchor: 'top',
      yref: 'y domain',
    },
  ];
  avgLayout.shapes = [
    {
      line: { dash: 'dot' },
      type: 'line',
      x0: 12,
      x1: 12,
      xref: 'x',
      y0: 0,
      y1: 1,
      yref: 'y domain',
    },
    {
      line: { dash: 'dot' },
      type: 'line',
      x0: 14,
      x1: 14,
      xref: 'x',
      y0: 0,
      y1: 1,
      yref: 'y domain',
    },
  ];
  avgLayout.legend = {
    tracegroupgap: 0,
  };
}

const options = {
  responsive: true,
  displayModeBar: false,
};

Plotly.newPlot('avg-timeline', avgData, avgLayout, options);
